<!DOCTYPE html>
<html>
<head>
    <title>Appeals Dashboard</title>
</head>
<body>
    <h1>Fraud Appeals Dashboard</h1>
    <p>Logged in as: <strong>{{ user.username }}</strong> (Role: {{ user.role }})</p>
    <a href="{{ url_for('logout') }}">🔒 Logout</a> |
    <a href="{{ url_for('index') }}">⬅ Back to Fraud Report</a>
    <br><br>

    <table border="1" cellpadding="6">
        <tr>
            <th>Email</th>
            <th>IP</th>
            <th>Status</th>
            <th>Message</th>
            <th>Action</th>
        </tr>
        {% for appeal in appeals %}
        <tr>
            <td>{{ appeal.email }}</td>
            <td>{{ appeal.ip }}</td>
            <td>{{ appeal.status }}</td>
            <td>{{ appeal.message if appeal.message else "—" }}</td>
            <td>
                {% if appeal.status == "pending" %}
                    {% if user.role == "admin" %}
                        <form action="/appeals/update" method="post" style="display:inline;">
                            <input type="hidden" name="email" value="{{ appeal.email }}">
                            <input type="hidden" name="ip" value="{{ appeal.ip }}">
                            <button type="submit" name="action" value="approve">✅ Approve</button>
                        </form>
                        <form action="/appeals/update" method="post" style="display:inline;">
                            <input type="hidden" name="email" value="{{ appeal.email }}">
                            <input type="hidden" name="ip" value="{{ appeal.ip }}">
                            <button type="submit" name="action" value="reject">❌ Reject</button>
                        </form>
                    {% else %}
                        <em>Only admins can decide</em>
                    {% endif %}
                {% else %}
                    <strong>{{ appeal.status | capitalize }}</strong>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>

    {% if debug %}
    <hr>
    <h3>⚠ Developer Tools</h3>
    <form action="/debug/reset" method="get" onsubmit="return confirm('Are you sure? This will delete ALL appeals!');">
        <button type="submit" style="background:red; color:white; padding:6px 12px; border:none; border-radius:4px;">
            🔄 Reset Database
        </button>
    </form>
    {% endif %}
</body>
</html>
