<!DOCTYPE html>
<html>
<head>
    <title>Fraud Report Dashboard</title>
</head>
<body>
    <h1>Fraud Detection Report</h1>
    <p>Logged in as: <strong>{{ user.username }}</strong> (Role: {{ user.role }})</p>
    <a href="{{ url_for('logout') }}">üîí Logout</a> | 
    <a href="{{ url_for('appeals_page') }}">üìÇ Appeals Dashboard</a>
    <br><br>

    <table border="1" cellpadding="6">
        <tr>
            <th>ID</th>
            <th>Email</th>
            <th>IP</th>
            <th>Flags</th>
            <th>Severity</th>
            <th>Confidence</th>
            <th>Timestamp</th>
            <th>Appeal</th>
        </tr>
        {% for r in results %}
        <tr>
            <td>{{ r.id }}</td>
            <td>{{ r.email }}</td>
            <td>{{ r.ip }}</td>
            <td>
                <ul>
                    {% for f in r.flags %}
                        <li>{{ f }}</li>
                    {% endfor %}
                </ul>
            </td>
            <td>
                {% if r.severity == "high" %}
                    <span style="color:red; font-weight:bold;">HIGH</span>
                {% elif r.severity == "medium" %}
                    <span style="color:orange; font-weight:bold;">MEDIUM</span>
                {% else %}
                    <span style="color:green; font-weight:bold;">LOW</span>
                {% endif %}
            </td>
            <td>
                {% if r.confidence >= 0.75 %}
                    <span style="color:red; font-weight:bold;">{{ r.confidence }}</span>
                {% elif r.confidence >= 0.4 %}
                    <span style="color:orange; font-weight:bold;">{{ r.confidence }}</span>
                {% else %}
                    <span style="color:green; font-weight:bold;">{{ r.confidence }}</span>
                {% endif %}
            </td>
            <td>{{ r.timestamp }}</td>
            <td>
                {% if r.appealed %}
                    <strong>Already appealed</strong>
                {% else %}
                    {% if user.role == "reviewer" or user.role == "admin" %}
                        <form action="/appeal" method="post" style="display:inline;">
                            <input type="hidden" name="email" value="{{ r.email }}">
                            <input type="hidden" name="ip" value="{{ r.ip }}">
                            <input type="text" name="message" placeholder="Reason" required>
                            <button type="submit">‚úç Submit Appeal</button>
                        </form>
                    {% else %}
                        <em>Appeals not allowed</em>
                    {% endif %}
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>
</body>
</html>
